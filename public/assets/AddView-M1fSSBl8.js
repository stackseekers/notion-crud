import{c as B,a as C,d as D}from"./vendor-primevue-BXJVR7wj.js";import{_ as L,a as P}from"./PageHeader-BItwT2hc.js";import{y as m,r as v,o as R,c as g,z as f,p as U,s as k,e as n,t as N,q,h as z,Q as M,d as p,n as W}from"./vendor-vue-3gpeyM8i.js";import{c as G,u as Q,_ as Z}from"./_plugin-vue_export-helper-TkE8fKGx.js";const H={class:"add-view"},J={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 mb-6"},K={class:"flex items-center"},X={class:"text-red-700 mt-1"},Y={key:2,class:"relative"},ee={class:"relative z-10 rounded-lg p-6"},te={__name:"AddView",setup(ae){const _=M(),b=B(),o=Q(),w=m(()=>o.loading),x=m(()=>o.submitting),h=m(()=>o.error),i=v(null),c=v({}),d=v(""),y=v(null),E=m(()=>i.value&&y.value&&!w.value&&!h.value),S={email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,phone:/^[+]?[1-9][\d]{0,15}$/},F=async()=>{try{await o.fetchSchema();const t=o.getDatabaseInfo(),e=t?.schema||o.schema,s=t?.title||o.schema?.title||"Item";if(!e){b.add({severity:"error",summary:"Schema Error",detail:"Failed to load database schema. Please try again.",life:3e3});return}y.value=e,d.value=s;const r=e?.properties?Object.fromEntries(Object.entries(e.properties).map(([l,a])=>{const u={...a,value:"",name:a.name||l,number:a.number||null,select:a.select||null,multi_select:a.multi_select||null,format:a.type==="number"?a.number?.format||a.format:void 0};return[l,u]})):{};i.value=r,c.value={}}catch(t){console.error("Failed to load database schema:",t)}},T=async()=>{await F()},$=t=>{Object.entries(t).forEach(([e,s])=>{i.value[e]&&(i.value[e].value=s)}),c.value={}},I=async()=>{if(!x.value)try{c.value={};const t=Object.fromEntries(Object.entries(i.value).map(([s,r])=>[s,r.value])),e=O(t,i.value);if(!e.isValid){c.value=e.errors;return}await o.createItem(t),b.add({severity:"success",summary:"Success",detail:`${d.value} added successfully`,life:3e3}),await W(),_.push("/")}catch(t){console.error("Create failed:",t);const e=o.error||t?.message||`Failed to add ${d.value.toLowerCase()}`;b.add({severity:"error",summary:"Error",detail:e,life:5e3})}},O=(t,e)=>{const s={};return e?(Object.entries(e).forEach(([r,l])=>{const a=t[r],u=a?.toString().trim();if(l.required&&(!a||u==="")){s[r]=`${j(r)} is required`;return}if(a&&u!=="")switch(l.type){case"email":{S.email.test(a)||(s[r]="Please enter a valid email address");break}case"url":{try{new URL(a)}catch{!a.startsWith("http://")&&!a.startsWith("https://")&&(s[r]="Please enter a valid URL (include http:// or https://)")}break}case"phone_number":{const A=a.replace(/[\s\-()]/g,"");S.phone.test(A)||(s[r]="Please enter a valid phone number");break}}}),{isValid:Object.keys(s).length===0,errors:s}):{isValid:!0,errors:{}}},j=t=>t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim(),V=()=>{_.push("/")};return R(()=>{F()}),(t,e)=>{const s=C,r=P,l=D;return p(),g("div",H,[f(L,{mode:"add","database-title":d.value,"show-back-button":!0,onGoBack:V},null,8,["database-title"]),w.value?(p(),U(Z,{key:0,count:1})):h.value?(p(),g("div",J,[n("div",K,[e[1]||(e[1]=n("i",{class:"pi pi-exclamation-triangle text-red-500 mr-3 text-xl"},null,-1)),n("div",null,[e[0]||(e[0]=n("h3",{class:"text-lg font-medium text-red-800"},"Error Loading Form",-1)),n("p",X,N(h.value),1)])]),f(s,{onClick:T,severity:"danger",class:"mt-4"},{default:q(()=>e[2]||(e[2]=[z(" Try Again ",-1)])),_:1,__:[2]})])):k("",!0),E.value?(p(),g("div",Y,[e[3]||(e[3]=n("div",{class:"absolute inset-0 bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg p-0.5 shadow-lg",style:{filter:"drop-shadow(0 10px 25px rgba(0, 144, 247, 0.3)) drop-shadow(0 4px 6px rgba(186, 98, 252, 0.2)) drop-shadow(0 1px 3px rgba(242, 65, 107, 0.2)) drop-shadow(0 0 0 rgba(245, 86, 0, 0.1))"}},[n("div",{class:"bg-white rounded-lg h-full w-full"})],-1)),n("div",ee,[f(r,{"editing-item":i.value,submitting:x.value,"form-errors":c.value,onSubmitForm:I,onRefreshSchema:T,"onUpdate:formData":$,onCancelForm:V},null,8,["editing-item","submitting","form-errors"])])])):k("",!0),f(l)])}}},ie=G(te,[["__scopeId","data-v-6b60163e"]]);export{ie as default};
