import{c as R,a as $,d as C}from"./vendor-primevue-BXJVR7wj.js";import{_ as P,a as U}from"./PageHeader-BItwT2hc.js";import{y as g,r as u,w as q,o as N,c as p,e as r,z as c,s as z,t as M,q as A,h as G,V as Q,Q as H,d as b,n as J}from"./vendor-vue-3gpeyM8i.js";import{c as K,u as W,_ as X,V as Y}from"./_plugin-vue_export-helper-TkE8fKGx.js";const Z={class:"edit-view"},ee={class:"max-w-4xl mx-auto p-6"},te={key:0},ae={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6"},se={class:"flex items-start gap-3"},oe={class:"flex-1"},re={class:"text-red-700"},ie={key:2,class:"relative"},ne={class:"relative z-10 bg-white rounded-lg p-6"},le={__name:"EditView",setup(de){const h=Q(),_=H(),m=R(),o=W(),E=g(()=>o.loading),v=g(()=>o.error),F=g(()=>o.submitting),i=u(null),d=u({}),f=u(""),x=u(null),I=u(!1),T=g(()=>i.value&&x.value&&!E.value&&!v.value),w=async()=>{const t=h.params.id;if(t)try{I.value=!0,d.value={};const[e,s]=await Promise.all([o.fetchItem(t),o.ensureSchemaLoaded().then(()=>o.schema)]),n=o.getDatabaseInfo(),a=n?.schema||s,D=n?.title||s?.title||"Item";if(!a){m.add({severity:"error",summary:"Schema Error",detail:"Failed to load database schema. Please try again.",life:3e3});return}if(!e){m.add({severity:"error",summary:"Item Not Found",detail:"The item you are trying to edit does not exist.",life:3e3}),_.push("/");return}x.value=a,f.value=D;const O=a?.properties?Object.fromEntries(Object.entries(a.properties).map(([y,l])=>{const B={...l,value:e[y]||"",name:l.name||y,number:l.number||null,select:l.select||null,multi_select:l.multi_select||null,format:l.type==="number"?l.number?.format||l.format:void 0};return[y,B]})):{};i.value=O}catch(e){console.error("Error loading item:",e)}finally{I.value=!1}},S=()=>{w()},V=t=>{Object.entries(t).forEach(([e,s])=>{i.value[e]&&(i.value[e].value=s)}),d.value={}},L=async()=>{if(!F.value)try{d.value={};const t=Object.fromEntries(Object.entries(i.value).map(([n,a])=>[n,a.value])),e=j(t,i.value);if(!e.isValid){d.value=e.errors;return}const s=h.params.id;await o.updateItem(s,t,x.value),m.add({severity:"success",summary:"Success",detail:`${f.value} updated successfully`,life:3e3}),await J(),_.push("/")}catch(t){console.error("Update failed:",t);const e=o.error||t?.message||`Failed to update ${f.value.toLowerCase()}`;m.add({severity:"error",summary:"Error",detail:e,life:5e3})}},j=(t,e)=>{const s={properties:Object.fromEntries(Object.entries(e).map(([n,a])=>[n,{type:a.type,required:a.required||!1,number:a.number,options:a.options,minLength:a.minLength,maxLength:a.maxLength}]))};return Y.validateFormData(t,s)},k=()=>{_.push("/")};return q(()=>h.params.id,(t,e)=>{t&&t!==e&&w()},{immediate:!1}),N(()=>{w()}),(t,e)=>{const s=$,n=U,a=C;return b(),p("div",Z,[r("div",ee,[c(P,{mode:"edit","database-title":f.value,"show-back-button":!0,onGoBack:k},null,8,["database-title"]),E.value||!i.value&&!v.value?(b(),p("div",te,[c(X,{count:1,"container-class":"bg-white rounded-lg shadow-sm border border-gray-200 p-6"})])):v.value?(b(),p("div",ae,[r("div",se,[e[2]||(e[2]=r("i",{class:"pi pi-exclamation-triangle text-red-500 text-xl mt-1"},null,-1)),r("div",oe,[e[1]||(e[1]=r("strong",{class:"text-red-800"},"Error:",-1)),r("span",re,M(v.value),1),c(s,{onClick:S,severity:"danger",text:""},{default:A(()=>e[0]||(e[0]=[G(" Try Again ",-1)])),_:1,__:[0]})])])])):T.value?(b(),p("div",ie,[e[3]||(e[3]=r("div",{class:"absolute inset-0 bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg p-0.5 shadow-lg",style:{filter:"drop-shadow(0 10px 25px rgba(0, 144, 247, 0.3)) drop-shadow(0 4px 6px rgba(186, 98, 252, 0.2)) drop-shadow(0 1px 3px rgba(242, 65, 107, 0.2)) drop-shadow(0 0 0 rgba(245, 86, 0, 0.1))"}},[r("div",{class:"bg-white rounded-lg h-full w-full"})],-1)),r("div",ne,[c(n,{"editing-item":i.value,submitting:F.value,"form-errors":d.value,onSubmitForm:L,onRefreshSchema:S,"onUpdate:formData":V,onCancelForm:k},null,8,["editing-item","submitting","form-errors"])])])):z("",!0)]),c(a)])}}},fe=K(le,[["__scopeId","data-v-0d1120e6"]]);export{fe as default};
